* I mainly relied on the templates and frameworks provided through Svelte, Svelthree, and Go Fiber *

---

# 3D Animations

This is a project that focuses on using [Go Fiber](https://docs.gofiber.io/), [Svelthree](https://svelthree.dev/), [Three.js](https://threejs.org/), 
and [Svelte-Cubed](https://github.com/Rich-Harris/svelte-cubed?ref=madewithsvelte.com) to deliver a website that can run multiple simultaneous 3D animations running at once.

I also used some 3D animations that you can go over in the following sections.


## Get started

To begin, make sure you're running [Node.js](https://nodejs.org) 16.7+, latest version of [Go Fiber](https://docs.gofiber.io/), and [Go](https://go.dev/) 1.14+.

Go to your top-level folder...
 ```bash
 cd <folder>
 ```

Install the dependencies...
```bash
npm install
```

... run the script to setup the [TypeScript](https://www.typescriptlang.org/) development environment ...
```bash
node scripts/setupTypeScript.js
```

...then start [Rollup](https://rollupjs.org) alongside [Go Fiber](https://docs.gofiber.io/)

```bash
npm run build && go run .
```

Navigate to the local site generated by [Go Fiber](http://127.0.0.1:3000). You should see your app running. 

Recommended to end the running program if you change any component in your code.

## Deploying to the web

I don't recommend any web deployment unless your system can handle the memory usage it needs. I tested it with my system and from my results, you need more than 8GB.

# Frameworks Used

## Svelte template

I used one of the provided [Svelte templates](https://github.com/sveltejs/template) to start the frontend-side of the project. 
```bash
npx degit sveltejs/template .
```
Although the repository is not maintained by the Svelte team anymore, it worked to setup the entire environment needed to run these 3D animations that used different types of libraries.

## Go Fiber - HTML Template

Go Fiber provides [Template interfaces](https://docs.gofiber.io/guide/templates) to run our template engine.

Our template engine, provided by Go Fiber, will render the HTML files in our ```templates``` folder. 
```go
engine := html.New("./templates", ".html")
```

From here, we can build the Fiber instance with its ```Views``` engine that will help our template engine render our HTML files.
```go
app := fiber.New(fiber.Config{
		Views: engine, //set as render engine
})
```
# Key Components

## main.go

In my ```main.go``` file, I decided to use [Go Fiber](https://docs.gofiber.io/) as my main web framework. It would allow me to host the 3D animations through a website. 

I needed to setup a ```go.mod``` file to call all the Go packages needed to run Go Fiber.

I also needed to setup a ```go.sum``` file to do a checksum on the packages used and avoid installing the packages again.

The specified Go packages in my ```main.go``` file were:
```
"time"
"github.com/gofiber/fiber/v2"
"github.com/gofiber/template/html"
```

### app.Static()
```go
app.Static("/public", "./public")
```
This allows our website to be able to access the ```public``` folder on our server. I didn't push the ```public``` folder on this repository due to its size. However, my template HTML file can be customized directly with a ```global.css``` file from that folder.

### app.Get()
```go
app.Get("/", mainPage)
```
A GET handler that returns the template HTML file with the 3D animations compiled in a single JS file using the ```mainpage``` function.

```go
app.Get("/time", func(c *fiber.Ctx) error {
		dt := time.Now()
		return c.SendString(dt.String())
})
```
With the help of the ```time``` Go package, we can get the latest time with this GET handler.

### app.Listen()
```go
app.Listen(":3000")
```
Once the entire web framework is set, we can start listening for any requests. 

### func mainpage()
```go
func mainPage(c *fiber.Ctx) error {
	return c.Render("mainpage", nil)
}
``` 
Function will render the ```mainpage.html``` file with the help of the template render engine we set up and return it through a GET request.

## src/main.ts
```ts
import App from './App.svelte';

const app = new App({
	target: document.getElementById('app'),
	props: {
		name: 'world'
	}
});


export default app;
```
This Typescript file serves to generate the ```App.svelte``` file, with its components, on the ```templates/mainpage.html``` file. It targets the ```<body id="app">``` tag and genereates the ```App.svelte``` file within that tag. We make sure we export the ```app``` variable on the Typescript file.

## src/svelthree.mjs
A bundled and minified version of (svelthree)[https://unpkg.com/svelthree@latest/dist/svelthree.mjs] that is used in some of the 3D animations. 

Setting the animations that required this file was very difficult since not all components were available through other Node.js libraries. I saved the file on my ```src``` folder to be able to run some of the 3D animations.

## rollup.config.js
[Rollup](https://rollupjs.org) serves to compile our ```src``` folder that contains all of our Svelte, JavaScript, and TypeScript code and bundles it into a single minified JavaScript file. It was provided with the Svelte template.

We need lots of Node.js libraries to be able to compile all these different file types together.

### export default
```js
export default {
	input: 'src/main.ts',
	output: {
		sourcemap: true,
		format: 'iife',
		name: 'app',
		file: 'public/build/bundle.js'
	},
	plugins: [
		svelte({
			preprocess: sveltePreprocess({ sourceMap: !production }),
			compilerOptions: {
				// enable run-time checks when not in production
				dev: !production,
			}, 
		}),
		// we'll extract any component CSS out into
		// a separate file - better for performance
		css({ output: 'bundle.css' }),

		// If you have external dependencies installed from
		// npm, you'll most likely need these plugins. In
		// some cases you'll need additional configuration -
		// consult the documentation for details:
		// https://github.com/rollup/plugins/tree/master/packages/commonjs
		resolve({
			browser: true,
			dedupe: ['svelte']
		}),
		commonjs(),
		typescript({
			sourceMap: !production,
			inlineSources: !production
		}),

		// In dev mode, call `npm run start` once
		// the bundle has been generated
		//!production && serve(),

		// Watch the `public` directory and refresh the
		// browser on changes when not in production
		!production && livereload('public'),

		// If we're building for production (npm run build
		// instead of npm run dev), minify
		production && terser()
	],
	watch: {
		clearScreen: false
	}
};
```
For this section, I will focus a little on how Rollup compiles the ```src``` folder.

#### Input
The first important part is to setup the input file provided by ```src/main.ts```. 
```js
input: 'src/main.ts'
```
Since most of our files are setup on ```src/App.svelte```, we only need to import that file to the input file. The rest of the input code will be taken into account by the compiler.

#### Output
We need to output the compiled code to a file. I setup the output file as ```public/build/bundle.js``` since I didn't want to upload the file to Github. 
```js
output: {
	sourcemap: true,
	format: 'iife',
	name: 'app',
	file: 'public/build/bundle.js'
}
```
I generated a ```sourcemap``` for my compiled JS file for debugging purposes. Personally, haven't used it but can be useful for future development.

#### Plugins
Rollup uses [plugins](https://rollupjs.org/guide/en/#using-plugins) to have more flexibility with our work environment that we'll compile. They will help the compiler change certain behaviors at some key points of the bundling process.
```js
plugins: [
	svelte({
		preprocess: sveltePreprocess({ sourceMap: !production }),
		compilerOptions: {
			// enable run-time checks when not in production
			dev: !production,
		}, 
	}),
	// we'll extract any component CSS out into
	// a separate file - better for performance
	css({ output: 'bundle.css' }),

	// If you have external dependencies installed from
	// npm, you'll most likely need these plugins. In
	// some cases you'll need additional configuration -
	// consult the documentation for details:
	// https://github.com/rollup/plugins/tree/master/packages/commonjs
	resolve({
		browser: true,
		dedupe: ['svelte']
	}),
	commonjs(),
	typescript({
		sourceMap: !production,
		inlineSources: !production
	}),

	// In dev mode, call `npm run start` once
	// the bundle has been generated
	//!production && serve(),

	// Watch the `public` directory and refresh the
	// browser on changes when not in production
	!production && livereload('public'),

	// If we're building for production (npm run build
	// instead of npm run dev), minify
	production && terser()
],
```

#### Plugin - Svelte
This plugin is in charge of handling our Svelte code.
```js
svelte({
	preprocess: sveltePreprocess({ sourceMap: !production }),
	compilerOptions: {
		// enable run-time checks when not in production
		dev: !production,
	}, 
})
```

#### Plugin - CSS
This plugin is to remove the CSS styling from our files to bundle it seperately. It helps with performance according to Svelte template.
```js
css({ output: 'bundle.css' })
```

#### Plugin - Resolve
This plugin is to handle the external dependencies installed from npm, which is how we install Node.js modules. 
```js
resolve({
	browser: true,
	dedupe: ['svelte']
})
```

#### Plugin - CommonJS
This plugin is to convert CommonJS modules to ES6 in order to include them in a Rollup bundle.
```js
commonjs()
```

#### Plugin - Typescript
```js
typescript({
	sourceMap: !production,
	inlineSources: !production
})
```

 

